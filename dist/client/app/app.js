var _=require("underscore"),Board=function(){function a(){this.reset()}var b=b||3,c=" ",d="◯",e="✖",f=[d,e];a.prototype.reset=function(){return this.won=!1,this.currentPlayer=0,this.grid=function(){for(var a=[],c=1;b>=c;c++)a.push(c);return a}.apply(this).map(function(){return function(){for(var a=[],c=1;b>=c;c++)a.push(c);return a}.apply(this).map(function(){return new g(c)})}),this.grid},a.prototype.playCell=function(a){if(!a.hasBeenPlayed()&&!this.won){a.mark(this.currentPlayerMarker());var b=this.winningMove(this.currentPlayerMarker());if(b){this.won=!0,this.winningMarker=this.currentPlayerMarker();for(var c=[],d=b.length,e=0;d>e;e++)a=b[e],c.push(a.winning=!0);return c}return this.switchPlayer()}},a.prototype.currentPlayerMarker=function(){return f[this.currentPlayer]},a.prototype.switchPlayer=function(){return this.currentPlayer^=1},a.prototype.winningMove=function(a){return this.winningRow(this.grid,a)||this.winningColumn(this.grid,a)||this.winningDiagonal(this.grid,a)},a.prototype.winningRow=function(a,b){return a.find(function(a){return a.every(function(a){return a.marker===b})})},a.prototype.winningColumn=function(a,b){return this.winningRow(_.zip.apply(null,a),b)},a.prototype.winningDiagonal=function(a,c){var d=function(a){return a.marker===c},e=function(){for(var c=[],d=b-1,e=0;d>=0?d>=e:e>=d;d>=0?e++:e--)c.push(a[e][e]);return c}();if(e.every(d))return e;var f=function(){var c=[],d=b-1;for(n=0;d>=0?n<=d:n>=d;d>=0?n++:n--)c.push(a[n][b-1-n]);return c}();return f.every(d)?f:void 0};var g=function(){function a(a,b){this.marker=a,this.winning=null!==b?b:!1}return a.prototype.mark=function(a){this.marker=a},a.prototype.hasBeenPlayed=function(){return this.marker!==c},a}();return a}();module.exports=function(a){a.factory("Board",function(){return Board})};